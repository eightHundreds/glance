# Proposal: add-model-provider-setting

## 背景
当前预览面板的总结区域只依赖 DOM 解析（defuddle）渲染 Markdown，下一步需要接入大模型以便在用户发出第一条总结请求时直接调用。但扩展目前没有任何地方能提前配置模型供应商或凭据：
- 无法记录用户希望使用的 LLM 平台（OpenAI 及兼容 API，如 DeepSeek、自托管 BFF 等），需要在首次请求时临时确认，导致体验中断；
- 没有 API Key/自定义 Base URL 等敏感信息的存储策略，summary 流程无法自动完成鉴权；
- 缺乏「尚未配置模型」的检测与提醒机制，summary UI 无法引导用户提前完成设置。

## 目标
1. 在 Options 页新增「大模型设置」区域，可选择 OpenAI 及所有 OpenAI 兼容的 API（如 DeepSeek、自托管 BFF 等），并填写所需凭据（API Key、Base URL、默认模型）。
2. 建立安全的存储与同步策略：供应商/模型名称等非敏感字段可继续随设置同步，密钥类字段仅保存在本地并提供显式更新入口；提交后可立即测试连通性。
3. 在内容脚本的页面总结流程中，若缺少必填的模型配置，summary 区域 MUST 给出醒目的设置指引；一旦配置就绪，首次提问要直接读取已选择的供应商并附带凭据，无需再次确认。

## 非目标
- 不实现具体的模型推理/总结 API 调用（仅准备配置与校验流程）。
- 不构建账户体系或与云后端同步 API Key。
- 不提供多模型轮询、费用统计等高级管理能力。

## 成功衡量
- Options 页可以完成供应商选择、凭据填写与保存，错误会就地提示；保存后刷新页面仍能看到相同配置。
- API Key 永远不会写入 `chrome.storage.sync`，但供应商/模型选择可随其他设置一起同步。
- 触发 summary 时如果未配置，UI 必须出现「前往模型设置」提示且不给用户发起模型请求；配置完成后首次提问无需额外对话即可命中预设供应商。

## 开放问题
- OpenAI 兼容模式中是否需要内置常见自托管服务预设模板？
- 如果用户希望云端同步 API Key，是否需要额外的加密方案，还是明确禁止？
- 连通性测试应访问哪个端点（`/v1/models` 或 `/v1/chat/completions`），以及是否需要节流与日志记录？
