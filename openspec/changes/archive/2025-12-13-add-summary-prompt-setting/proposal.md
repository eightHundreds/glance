# Proposal: add-summary-prompt-setting

## 背景
当前的大模型配置页仅允许用户选择供应商、模型与 API Key，但 summary 流程仍使用内置的固定 prompt。随着场景扩展，不同团队希望预先注入自定义上下文（例如语气、输出格式、敏感词提醒），否则每次都需要手动在提问中重复说明，体验割裂：
- 无论用户选择哪个模型，系统 prompt 始终一致，无法对接团队规范；
- Options 页缺少可视化的 prompt 文案输入框，用户不知道下发给模型的初始指令是什么；
- 内容脚本也无法快速判断「是否已配置自定义 prompt」，因此无法在 summary 中提示或渲染默认描述。

## 目标
1. 在大模型设置区域新增「总结 Prompt」输入框，提供默认模版、描述用途、支持多行编辑（预计 500~1000 字符），并在失焦时自动保存。
2. 在设置存储层新增 `summaryPrompt` 字段：可随其他同步字段一起存储/同步，同时提供回退默认文案；Options UI 需要显示最后保存时间或状态。
3. Summary 管道在构造第一条模型消息时 MUST 优先读取此 prompt，若用户未自定义则使用默认值；任何请求失败日志需包含 prompt 版本，方便排查。

## 非目标
- 不实现 prompt 版本管理、细粒度环境变量或多 prompt slot。
- 不提供跨浏览器导入/导出或分享 prompt 的功能。
- 不构建 prompt 模板市场或云端存储。

## 成功衡量
- Options 页展示的 prompt 文案在刷新后保持一致，且输入无明显卡顿；
- `summaryPrompt` 在支持 sync 的浏览器中会随其他非敏感字段同步，在未配置模型时仍能单独保存；
- 触发 summary 生成时请求 payload 中包含最新 prompt，若 prompt 为空则自动落回默认值；
- 手动清空 prompt 后保存，UI 能提示使用默认文案，summary 实际也读取默认值。

## 开放问题
- 默认 prompt 文案是否由产品提供具体内容？目前计划使用“提炼网页要点 + 输出 Markdown”通用模板。
- 是否需要限制最大字符数并给出实时计数？初稿考虑 1000 字符上线。
- 是否需要在内容脚本内暴露「当前 prompt 来源」给调试日志？
